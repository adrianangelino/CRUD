generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Company {
  id         Int          @id @default(autoincrement())
  name       String
  users      User[]
  events     Events[]
  tickets    Ticket[]
  TicketType TicketType[]
}

model Role {
  id    Int    @id @default(autoincrement())
  name  String @unique // Ex: 'admin', 'cliente'
  users User[]
}

model User {
  id        Int       @id @default(autoincrement())
  name      String
  email     String    @unique
  password  String
  createdAt DateTime  @default(now())
  deletedAt DateTime?
  tickets   Ticket[]
  companyId Int
  company   Company   @relation(fields: [companyId], references: [id])
  roleId    Int
  role      Role      @relation(fields: [roleId], references: [id])
}

model TicketType {
  id        Int       @id @default(autoincrement())
  name      String    @unique
  price     Float
  endDate   DateTime
  quantity  Int
  companyId Int
  deletedAt DateTime?
  company   Company   @relation(fields: [companyId], references: [id])
  tickets   Ticket[]
  events    Events[]
}

model Events {
  id           Int        @id @default(autoincrement())
  name         String
  startDate    DateTime
  endDate      DateTime
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  deletedAt    DateTime?
  tickets      Ticket[]
  companyId    Int
  company      Company    @relation(fields: [companyId], references: [id])
  quantity     Int
  ticketTypeId Int
  ticketType   TicketType @relation(fields: [ticketTypeId], references: [id])
}

model Ticket {
  id           Int        @id @default(autoincrement())
  name         String
  hash         String?    @unique
  pdfUrl       String?
  status       String     @default("pending")
  deletedAt    DateTime?
  createdAt    DateTime   @default(now())
  eventId      Int
  event        Events     @relation(fields: [eventId], references: [id])
  userId       Int
  user         User       @relation(fields: [userId], references: [id])
  companyId    Int
  company      Company    @relation(fields: [companyId], references: [id])
  ticketTypeId Int
  ticketType   TicketType @relation(fields: [ticketTypeId], references: [id])
}
